/*! user - v0.1.0 -  2016-04-14 */$(function(){function MainModel(){}function VM(){}function PurchaseProductModel(pprIds,nums,isMain,grpNo){this.pprIds=pprIds,this.nums=nums,this.isMain=isMain,this.grpNo=grpNo}function InfoModel(purchaseClass,brandCode,name,summary){this.purchaseClass=purchaseClass,this.brandCode=brandCode,this.name=name,this.summary=summary}function SpecificationModel(ppId,pvId,isGlobal){this.ppId=ppId,this.pvId=pvId,this.isGlobal=isGlobal}function getSpecificationsByAjax(callback){$.ajax({url:"../json/specifications.json",type:"GET",dataType:"json"}).then(function(data){vm.setVm("info",data),callback(vm)},function(){console.log("商品规格请求出错")})}function _render(id,data){return template(id,data)}function _renderRelatedProductView(){var number=+$("#relativeProductNum").val(),$relativeProductView=$("#relativeProductView"),relatedProView=_render("Warehouse.RelatedPro",{repeat:number});$relativeProductView.empty().html(relatedProView),$relativeProductView.find("[name='isMain']").one("change",function(){_productInfoRender()})}function _productInfoRender(){getSpecificationsByAjax(function(vm){var productInfoView=_render("Warehouse.ProductInfo",vm);$("#productInfoView").empty().html(productInfoView)}),$("#fileupload").fileupload({url:"server/php/",previewMaxWidth:100,previewMaxHeight:100})}function collPurchaseProductsModel(){var purchaseProducts=[];return $(".related-pro").each(function(index,value){var nums,isMain,grpNo,$this=$(this),pprIds=[];$this.find(".J_pprId").each(function(i,dom){pprIds.push($(dom).text())}),nums=+$this.find(".J_nums").val(),isMain=+$this.find("[name='isMain']:checked").length,grpNo=index;var purchaseProduct=new PurchaseProductModel(pprIds,nums,isMain,grpNo);purchaseProducts.push(purchaseProduct)}),mainModel.setPurchaseProductsModel(purchaseProducts),purchaseProducts}function collPurchaseInfoModel(){var purchaseClass,brandCode,name,summary;purchaseClass=$("#purchaseClass").val(),brandCode=$("#brandCode").val(),name=$("#brandName").val(),summary=$("#brandSummary").val();var infoModel=new InfoModel(purchaseClass,brandCode,name,summary);mainModel.setInfoModel(infoModel)}function collSpecificationsModel(){$(".J_productStandardItem:visible").each(function(index,val){var isGlobal,$radio=$(val).find("[type=radio]:checked"),isNew=$radio.data("new");isNew&&(isGlobal=0);new SpecificationModel})}function saveForm(){collPurchaseProductsModel(),collPurchaseInfoModel(),collSpecificationsModel(),console.log(mainModel)}function _init(){$(".tab-pane").on("change","input:radio[name=isWarehouse]",function(){+$(this).val()?(vm=new VM,$("#ifWarehouseView").empty().html(_render("Warehouse.Main",{})),_renderRelatedProductView()):(vm=new VM,console.log("加载不入仓模板"))}),$("#saveFormBtn").on("click",function(){saveForm()})}var vm,mainModel=new MainModel;_init(),VM.prototype.setVm=function(key,value){this[key]=value},MainModel.prototype.setPurchaseProductsModel=function(purchaseProducts){this.purchaseProducts=purchaseProducts},MainModel.prototype.setInfoModel=function(info){this.info=info},MainModel.prototype.setSpecificationsModel=function(specifications){this.specifications=specifications},MainModel.prototype.setPropertiesModel=function(properties){this.properties=properties},MainModel.prototype.setPicsModel=function(pics){this.pics=pics},MainModel.prototype.setDetailDescModel=function(pics){this.pics=pics},function(){$("#ifWarehouseView").on("click","#relativeProductNumBtn",function(){_renderRelatedProductView()}),$("#ifWarehouseView").on("click",".J_relatedBtn",function(){var $itemRoot=$(this).closest(".related-pro"),$tbody=$itemRoot.find("tbody"),relatedProView=_render("Warehouse.RelatedProTableTr",{});$tbody.append(relatedProView)})}(),function(){$("#ifWarehouseView").on("click",".pic-list .sort-l",function(){var $item=$(this).closest("li");1!==$item.index()&&$item.prev().before($item)}).on("click",".pic-list .sort-r",function(){var $item=$(this).closest("li");$item.next().length&&$item.next().after($item)}),$("#ifWarehouseView").on("click",".J_btn-add-standard",function(){var $addInput=$(this).prev(".hidden");$addInput.before($addInput.clone().removeClass("hidden"))}),$("#ifWarehouseView").on("click",".x",function(){$(this).parent().fadeOut("fast")}),$("#ifWarehouseView").on("click",".parameter-btn",function(){var $edit=$("#product-param-edit").clone().removeClass("hidden");$(".J_product-param").append($edit)}),$("#ifWarehouseView").on("change",".J_specifications_checkbox_item",function(){var $this=$(this),index=$this.index(),isChecked=$this.find(":checkbox").prop("checked"),$item=$(".J_productStandardItem").eq(index);isChecked?$item.removeClass("hidden"):$item.addClass("hidden")})}(),function(){$("#ifWarehouseView").on("change","#firstCategory, #secondCategory, #thirdCategory",function(){_productInfoRender()})}()});